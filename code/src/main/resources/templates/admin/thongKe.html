<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/index}">
<head>
    <meta charset="UTF-8">
    <title>Th·ªëng k√™</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body >
<div layout:fragment="content" class="container mt-4">
<h2 class="mb-3">üìä Doanh thu theo ng√†y</h2>

<!-- B·∫£ng doanh thu -->
<table class="table table-bordered">
    <thead>
    <tr>
        <th>Ng√†y</th>
        <th>Doanh thu</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="d : ${doanhThu}">
        <td th:text="${d.label}"></td>
        <td th:text="${#numbers.formatDecimal(d.doanhThu, 0, 'POINT', 0, 'COMMA')} + ' VNƒê'"></td>
    </tr>
    </tbody>
</table>

<!-- Bi·ªÉu ƒë·ªì doanh thu -->
<canvas id="doanhThuChart" class="mb-5"></canvas>

<h2 class="mt-5 mb-3">üî• Top 5 s·∫£n ph·∫©m b√°n ch·∫°y</h2>

<!-- B·∫£ng top s·∫£n ph·∫©m -->
<table class="table table-striped">
    <thead>
    <tr>
        <th>T√™n s·∫£n ph·∫©m</th>
        <th>S·ªë l∆∞·ª£ng b√°n</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="sp : ${topSanPham}">
        <td th:text="${sp.tenSanPham}"></td>
        <td th:text="${sp.soLuongBan}"></td>
    </tr>
    </tbody>
</table>

<!-- Bi·ªÉu ƒë·ªì top s·∫£n ph·∫©m -->
<canvas id="topSanPhamChart"></canvas>

<script th:inline="javascript">
    // L·∫•y d·ªØ li·ªáu t·ª´ Thymeleaf
    const doanhThuLabels = [[${doanhThu}]].map(d => d.label);
    console.log(doanhThuLabels)
    const doanhThuValues = [[${doanhThu}]].map(d => d.doanhThu);
    console.log(doanhThuValues)

    const spLabels = [[${topSanPham}]].map(sp => sp.tenSanPham);
    const spValues = [[${topSanPham}]].map(sp => sp.soLuongBan);

    // Bi·ªÉu ƒë·ªì doanh thu
    new Chart(document.getElementById("doanhThuChart"), {
        type: 'bar',
        data: {
            labels: doanhThuLabels,
            datasets: [{
                label: "Doanh thu (VNƒê)",
                data: doanhThuValues,
                backgroundColor: "rgba(54, 162, 235, 0.6)"
            }]
        }
    });

    // Bi·ªÉu ƒë·ªì top s·∫£n ph·∫©m
    new Chart(document.getElementById("topSanPhamChart"), {
        type: 'pie',
        data: {
            labels: spLabels,
            datasets: [{
                label: "S·ªë l∆∞·ª£ng b√°n",
                data: spValues,
                backgroundColor: [
                    "rgba(255, 99, 132, 0.6)",
                    "rgba(54, 162, 235, 0.6)",
                    "rgba(255, 206, 86, 0.6)",
                    "rgba(75, 192, 192, 0.6)",
                    "rgba(153, 102, 255, 0.6)"
                ]
            }]
        }
    });
</script>

</div>
</body>

</html>
